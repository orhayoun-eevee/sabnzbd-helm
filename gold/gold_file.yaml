---
# Source: sabnzbd/templates/all.yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: sabnzbd-default
  namespace: download-clients
  labels:
    app.kubernetes.io/instance: sabnzbd
    app.kubernetes.io/name: sabnzbd
    app.kubernetes.io/version: 4.5.3
    helm.sh/chart: sabnzbd-0.0.4
    app.kubernetes.io/component: "network-policy"
  annotations:
    argocd.argoproj.io/sync-wave: "1"
spec:
  podSelector:
    matchLabels:
      app.kubernetes.io/instance: sabnzbd
      app.kubernetes.io/name: sabnzbd
  policyTypes:
    - Ingress
    - Egress
  ingress:
    - from:
      - namespaceSelector:
          matchLabels:
            kubernetes.io/metadata.name: istio-system
        podSelector:
          matchLabels:
            app.kubernetes.io/name: shared-platform-gateway
      - namespaceSelector:
          matchLabels:
            kubernetes.io/metadata.name: monitoring
        podSelector:
          matchLabels:
            app.kubernetes.io/name: prometheus
      - namespaceSelector:
          matchLabels:
            kubernetes.io/metadata.name: homeassistant
        podSelector:
          matchLabels:
            app.kubernetes.io/name: home-assistant
      - namespaceSelector:
          matchLabels:
            kubernetes.io/metadata.name: media-center
        podSelector:
          matchLabels:
            app.kubernetes.io/part-of: media-center
      ports:
      - port: 15008
        protocol: TCP
  egress:
    - ports:
      - port: 53
        protocol: UDP
      - port: 53
        protocol: TCP
      to:
      - namespaceSelector:
          matchLabels:
            kubernetes.io/metadata.name: kube-system
        podSelector:
          matchLabels:
            k8s-app: kube-dns
    - ports:
      - port: 563
        protocol: TCP
      to:
      - ipBlock:
          cidr: 0.0.0.0/0
          except:
          - 10.42.0.0/16
          - 10.43.0.0/16
          - 192.168.0.0/16
    - ports:
      - port: 15008
        protocol: TCP
      to:
      - namespaceSelector:
          matchLabels:
            kubernetes.io/metadata.name: istio-system
---
# Source: sabnzbd/templates/all.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: sabnzbd
  namespace: download-clients
  labels:
    app.kubernetes.io/instance: sabnzbd
    app.kubernetes.io/name: sabnzbd
    app.kubernetes.io/version: 4.5.3
    helm.sh/chart: sabnzbd-0.0.4
    app.kubernetes.io/component: "serviceaccount"
  annotations:
    app.kubernetes.io/managed-by: argocd
    description: SABnzbd media center service account
automountServiceAccountToken: false
---
# Source: sabnzbd/templates/all.yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: sabnzbd-config
  namespace: download-clients
  labels:
    app.kubernetes.io/instance: sabnzbd
    app.kubernetes.io/name: sabnzbd
    app.kubernetes.io/version: 4.5.3
    helm.sh/chart: sabnzbd-0.0.4
    app.kubernetes.io/component: "pvc"
  annotations:
    helm.sh/resource-policy: keep
spec:
  accessModes:
    - ReadWriteOnce
  storageClassName: longhorn
  resources:
    requests:
      storage: 2Gi
---
# Source: sabnzbd/templates/all.yaml
apiVersion: v1
kind: Service
metadata:
  name: sabnzbd-http
  namespace: download-clients
  labels:
    app.kubernetes.io/instance: sabnzbd
    app.kubernetes.io/name: sabnzbd
    app.kubernetes.io/version: 4.5.3
    helm.sh/chart: sabnzbd-0.0.4
    app.kubernetes.io/component: service-http
  annotations:
    description: SABnzbd media center HTTP service
spec:
  type: ClusterIP
  ports:
    - name: http
      port: 8080
      targetPort: http
      protocol: TCP
  selector:
    app.kubernetes.io/instance: sabnzbd
    app.kubernetes.io/name: sabnzbd
---
# Source: sabnzbd/templates/all.yaml
apiVersion: v1
kind: Service
metadata:
  name: sabnzbd-metrics
  namespace: download-clients
  labels:
    app.kubernetes.io/instance: sabnzbd
    app.kubernetes.io/name: sabnzbd
    app.kubernetes.io/version: 4.5.3
    helm.sh/chart: sabnzbd-0.0.4
    app.kubernetes.io/component: service-metrics
  annotations:
    description: SABnzbd metrics service
spec:
  type: ClusterIP
  ports:
    - name: metrics
      port: 9100
      targetPort: metrics
      protocol: TCP
  selector:
    app.kubernetes.io/instance: sabnzbd
    app.kubernetes.io/name: sabnzbd
---
# Source: sabnzbd/templates/all.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: sabnzbd
  namespace: download-clients
  labels:
    app.kubernetes.io/instance: sabnzbd
    app.kubernetes.io/name: sabnzbd
    app.kubernetes.io/version: 4.5.3
    helm.sh/chart: sabnzbd-0.0.4
    app.kubernetes.io/component: "deployment"
spec:
  replicas: 1
  revisionHistoryLimit: 3
  strategy:
    type: Recreate
  selector:
    matchLabels:
      app.kubernetes.io/instance: sabnzbd
      app.kubernetes.io/name: sabnzbd
  template:
    metadata:
      labels:
        app.kubernetes.io/instance: sabnzbd
        app.kubernetes.io/name: sabnzbd
        app.kubernetes.io/version: 4.5.3
        helm.sh/chart: sabnzbd-0.0.4
        app.kubernetes.io/component: downloader
        app.kubernetes.io/part-of: download-clients
        logging.kubernetes.io/component: download-clients
        logging.kubernetes.io/service: sabnzbd
    spec:
      terminationGracePeriodSeconds: 60
      securityContext:
        fsGroup: 1010
        fsGroupChangePolicy: OnRootMismatch
        runAsNonRoot: true
        supplementalGroups: []
      serviceAccountName: sabnzbd
      dnsPolicy: ClusterFirst
      automountServiceAccountToken: false
      enableServiceLinks: false
      containers:
        - name: exportarr
          image: ghcr.io/orhayoun/exportarr:v2.3.1@sha256:2650f6a501b1d691daf5dfe758068f44336d0bb1d443f9db2c94900244d423bc
          imagePullPolicy: IfNotPresent
          ports:
            - name: metrics
              containerPort: 9100
              protocol: TCP
          args:
            - sabnzbd
          env:
            - name: URL
              value: http://localhost:8080
            - name: CONFIG
              value: /config/sabnzbd.ini
            - name: PORT
              value: "9100"
            - name: ENABLE_ADDITIONAL_METRICS
              value: "false"
            - name: ENABLE_UNKNOWN_QUEUE_ITEMS
              value: "false"
          volumeMounts:
            - mountPath: /config
              name: config
              readOnly: true
          resources:
            limits:
              cpu: 100m
              ephemeral-storage: 10Mi
              memory: 64Mi
            requests:
              cpu: 10m
              ephemeral-storage: 10Mi
              memory: 32Mi
          livenessProbe:
            failureThreshold: 3
            httpGet:
              path: /metrics
              port: metrics
              scheme: HTTP
            initialDelaySeconds: 30
            periodSeconds: 30
            successThreshold: 1
            timeoutSeconds: 5
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /metrics
              port: metrics
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 5
          startupProbe:
            failureThreshold: 30
            httpGet:
              path: /metrics
              port: metrics
              scheme: HTTP
            initialDelaySeconds: 45
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 10
          securityContext:
            allowPrivilegeEscalation: false
            appArmorProfile:
              type: RuntimeDefault
            capabilities:
              drop:
              - ALL
            readOnlyRootFilesystem: true
            runAsGroup: 65534
            runAsNonRoot: true
            runAsUser: 65534
            seccompProfile:
              type: RuntimeDefault
        - name: sabnzbd
          image: ghcr.io/runlix/sabnzbd:release-4.5.5-latest@sha256:826caa03179efed2d9ebb636d1cfbe50ba9a7982d467aa3288ebdb6c52c7e803
          imagePullPolicy: IfNotPresent
          ports:
            - name: http
              containerPort: 8080
              protocol: TCP
          env:
            - name: TZ
              value: UTC
          volumeMounts:
            - mountPath: /config
              name: config
            - mountPath: /backup
              name: backup
            - mountPath: /downloads
              name: downloads
            - mountPath: /media
              name: media
            - mountPath: /tmp
              name: tmp
          resources:
            limits:
              cpu: 1000m
              ephemeral-storage: 2Gi
              memory: 2Gi
            requests:
              cpu: 1000m
              ephemeral-storage: 2Gi
              memory: 256Mi
          livenessProbe:
            failureThreshold: 3
            httpGet:
              path: /
              port: http
              scheme: HTTP
            initialDelaySeconds: 30
            periodSeconds: 30
            successThreshold: 1
            timeoutSeconds: 10
          readinessProbe:
            failureThreshold: 3
            httpGet:
              path: /
              port: http
              scheme: HTTP
            initialDelaySeconds: 15
            periodSeconds: 10
            successThreshold: 1
            timeoutSeconds: 5
          startupProbe:
            failureThreshold: 30
            httpGet:
              path: /
              port: http
              scheme: HTTP
            initialDelaySeconds: 10
            periodSeconds: 5
            successThreshold: 1
            timeoutSeconds: 5
          securityContext:
            allowPrivilegeEscalation: false
            appArmorProfile:
              type: RuntimeDefault
            capabilities:
              drop:
              - ALL
            privileged: false
            readOnlyRootFilesystem: true
            runAsGroup: 1010
            runAsNonRoot: true
            runAsUser: 1010
            seccompProfile:
              type: RuntimeDefault
      volumes:
        -
          name: config
          persistentVolumeClaim:
            claimName: sabnzbd-config
        -
          name: downloads
          nfs:
            path: /mnt/vol1/media-center/downloads
            server: snorlax.orhayoun.com
        -
          name: media
          nfs:
            path: /mnt/vol1/media-center/media
            server: snorlax.orhayoun.com
        -
          name: backup
          nfs:
            path: /mnt/vol1/media-center/backup/sabnzbd
            server: snorlax.orhayoun.com
        -
          emptyDir:
            sizeLimit: 1Gi
          name: tmp
---
# Source: sabnzbd/templates/all.yaml
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: sabnzbd-homeassistant
  namespace: download-clients
  labels:
    app.kubernetes.io/instance: sabnzbd
    app.kubernetes.io/name: sabnzbd
    app.kubernetes.io/version: 4.5.3
    helm.sh/chart: sabnzbd-0.0.4
    app.kubernetes.io/component: "authorization-policy"
  annotations:
    argocd.argoproj.io/sync-wave: "1"
spec:
  selector:
    matchLabels:
      app.kubernetes.io/instance: sabnzbd
      app.kubernetes.io/name: sabnzbd
  action: ALLOW
  rules:
    - from:
      - source:
          principals:
          - cluster.local/ns/homeassistant/sa/homeassistant-home-assistant
      to:
      - operation:
          ports:
          - "8080"
---
# Source: sabnzbd/templates/all.yaml
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: sabnzbd-ingress
  namespace: download-clients
  labels:
    app.kubernetes.io/instance: sabnzbd
    app.kubernetes.io/name: sabnzbd
    app.kubernetes.io/version: 4.5.3
    helm.sh/chart: sabnzbd-0.0.4
    app.kubernetes.io/component: "authorization-policy"
  annotations:
    argocd.argoproj.io/sync-wave: "1"
spec:
  selector:
    matchLabels:
      app.kubernetes.io/instance: sabnzbd
      app.kubernetes.io/name: sabnzbd
  action: ALLOW
  rules:
    - from:
      - source:
          principals:
          - cluster.local/ns/istio-system/sa/shared-platform-gateway-istio
      to:
      - operation:
          ports:
          - "8080"
---
# Source: sabnzbd/templates/all.yaml
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: sabnzbd-media-services
  namespace: download-clients
  labels:
    app.kubernetes.io/instance: sabnzbd
    app.kubernetes.io/name: sabnzbd
    app.kubernetes.io/version: 4.5.3
    helm.sh/chart: sabnzbd-0.0.4
    app.kubernetes.io/component: "authorization-policy"
  annotations:
    argocd.argoproj.io/sync-wave: "1"
spec:
  selector:
    matchLabels:
      app.kubernetes.io/instance: sabnzbd
      app.kubernetes.io/name: sabnzbd
  action: ALLOW
  rules:
    - from:
      - source:
          principals:
          - cluster.local/ns/media-center/sa/radarr
          - cluster.local/ns/media-center/sa/sonarr
      to:
      - operation:
          ports:
          - "8080"
---
# Source: sabnzbd/templates/all.yaml
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: sabnzbd-prometheus
  namespace: download-clients
  labels:
    app.kubernetes.io/instance: sabnzbd
    app.kubernetes.io/name: sabnzbd
    app.kubernetes.io/version: 4.5.3
    helm.sh/chart: sabnzbd-0.0.4
    app.kubernetes.io/component: "authorization-policy"
  annotations:
    argocd.argoproj.io/sync-wave: "1"
spec:
  selector:
    matchLabels:
      app.kubernetes.io/instance: sabnzbd
      app.kubernetes.io/name: sabnzbd
  action: ALLOW
  rules:
    - from:
      - source:
          principals:
          - cluster.local/ns/monitoring/sa/prometheus-kube-prometheus-prometheus
      to:
      - operation:
          ports:
          - "9100"
---
# Source: sabnzbd/templates/all.yaml
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: sabnzbd
  namespace: download-clients
  labels:
    app.kubernetes.io/instance: sabnzbd
    app.kubernetes.io/name: sabnzbd
    app.kubernetes.io/version: 4.5.3
    helm.sh/chart: sabnzbd-0.0.4
    app.kubernetes.io/component: "destination-rule"
  annotations:
    argocd.argoproj.io/sync-wave: "1"
spec:
  host: sabnzbd-http
  trafficPolicy:
    connectionPool:
      http:
        http1MaxPendingRequests: 50
        http2MaxRequests: 200
        maxRequestsPerConnection: 10
      tcp:
        maxConnections: 200
    outlierDetection:
      baseEjectionTime: 15s
      consecutive5xxErrors: 5
      interval: 30s
      maxEjectionPercent: 50
---
# Source: sabnzbd/templates/all.yaml
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: sabnzbd-sabnzbd-dashboard
  namespace: download-clients
  labels:
    app.kubernetes.io/component: grafana-dashboard
    app.kubernetes.io/instance: sabnzbd
    app.kubernetes.io/name: sabnzbd
    app.kubernetes.io/version: 4.5.3
    helm.sh/chart: sabnzbd-0.0.4
spec:
  json: |
    {"annotations":{"list":[{"builtIn":1,"datasource":{"type":"grafana","uid":"-- Grafana --"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations \u0026 Alerts","type":"dashboard"}]},"editable":true,"fiscalYearStartMonth":0,"graphTooltip":0,"id":169,"links":[],"liveNow":false,"panels":[{"collapsed":false,"gridPos":{"h":1,"w":24,"x":0,"y":0},"id":100,"panels":[],"title":"ðŸ“Š Application Metrics","type":"row"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[{"options":{"0":{"color":"gray","text":"Unknown"},"1":{"color":"green","text":"Idle"},"2":{"color":"yellow","text":"Paused"},"3":{"color":"blue","text":"Downloading"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"gray","value":null},{"color":"green","value":1},{"color":"yellow","value":2},{"color":"blue","value":3}]},"unit":"short"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":0,"y":1},"id":1,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showPercentChange":false,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sabnzbd_status{service=\"sabnzbd\", component=\"download-clients\"} * on(pod) group_left() (kube_pod_status_phase{namespace=\"$namespace\",pod=~\"$pod_regex\",phase=\"Running\"} @ end())","refId":"A"}],"title":"System Status","type":"stat"},{"datasource":{"name":"Prometheus","type":"prometheus"},"description":"Alerts: SabnzbdQueueHigh","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":10},{"color":"red","value":50}]},"unit":"short"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":6,"y":1},"id":2,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showPercentChange":false,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sabnzbd_queue_length{service=\"sabnzbd\", component=\"download-clients\"} * on(pod) group_left() (kube_pod_status_phase{namespace=\"$namespace\",pod=~\"$pod_regex\",phase=\"Running\"} @ end())","refId":"A"}],"title":"Queue Size","type":"stat"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"Bps"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":12,"y":1},"id":3,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showPercentChange":false,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sabnzbd_speed_bps{service=\"sabnzbd\", component=\"download-clients\"} * on(pod) group_left() (kube_pod_status_phase{namespace=\"$namespace\",pod=~\"$pod_regex\",phase=\"Running\"} @ end())","refId":"A"}],"title":"Download Speed","type":"stat"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[{"options":{"match":"null","result":{"text":"N/A"}},"type":"special"},{"options":{"from":-999999999999,"result":{"color":"green","text":"Draining"},"to":0},"type":"range"},{"options":{"from":0,"result":{"color":"red","text":"Growing"},"to":999999999999},"type":"range"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":0}]},"unit":"Bps"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":18,"y":1},"id":34,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showPercentChange":false,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"deriv((sabnzbd_remaining_bytes{service=\"sabnzbd\", component=\"download-clients\"} * on(pod) group_left() (kube_pod_status_phase{namespace=\"$namespace\",pod=~\"$pod_regex\",phase=\"Running\"} @ end()))[5m:])","refId":"A"}],"title":"Queue Drain Rate","type":"stat"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"fillOpacity":70,"hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineWidth":0,"spanNulls":false},"mappings":[{"options":{"0":{"color":"gray","text":"Unknown"},"1":{"color":"green","text":"Idle"},"2":{"color":"yellow","text":"Paused"},"3":{"color":"blue","text":"Downloading"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"gray","value":null},{"color":"green","value":1},{"color":"yellow","value":2},{"color":"blue","value":3}]},"unit":"short"},"overrides":[{"matcher":{"id":"byName","options":"{component=\"download-clients\", container=\"exporter\", endpoint=\"metrics\", job=\"sabnzbd-metrics\", namespace=\"download-clients\", service=\"sabnzbd\", url=\"http://localhost:8080\"}"},"properties":[{"id":"displayName","value":"."}]}]},"gridPos":{"h":8,"w":12,"x":0,"y":5},"id":5,"options":{"alignValue":"left","legend":{"displayMode":"list","placement":"bottom","showLegend":true},"mergeValues":true,"rowHeight":0.9,"showValue":"auto","showValues":"never","tooltip":{"mode":"single","sort":"none"}},"pluginVersion":"10.0.0","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"max without (pod, instance) (sabnzbd_status{service=\"sabnzbd\", component=\"download-clients\"})","legendFormat":"","refId":"A"}],"title":"System Status Over Time","type":"state-timeline"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"short"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":12,"y":5},"id":6,"options":{"legend":{"calcs":["last","max","mean"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"10.0.0","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sabnzbd_queue_length{service=\"sabnzbd\", component=\"download-clients\"}","legendFormat":"Queue Size","refId":"A"}],"title":"Queue Size Over Time","type":"timeseries"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"Bps"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":13},"id":7,"options":{"legend":{"calcs":["last","max","mean"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"10.0.0","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sabnzbd_speed_bps{service=\"sabnzbd\", component=\"download-clients\"}","legendFormat":"Download Speed","refId":"A"}],"title":"Download Speed Over Time","type":"timeseries"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":12,"y":13},"id":8,"options":{"legend":{"calcs":["last","max","mean"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"10.0.0","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sabnzbd_total_bytes{service=\"sabnzbd\", component=\"download-clients\"}","legendFormat":"Total Queue Size","refId":"A"}],"title":"Total Queue Size Over Time","type":"timeseries"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[{"options":{"0":{"color":"green","text":"Not Paused"},"1":{"color":"yellow","text":"Paused"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":1}]},"unit":"short"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":0,"y":21},"id":28,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showPercentChange":false,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sabnzbd_paused{service=\"sabnzbd\", component=\"download-clients\"} * on(pod) group_left() (kube_pod_status_phase{namespace=\"$namespace\",pod=~\"$pod_regex\",phase=\"Running\"} @ end())","refId":"A"}],"title":"Paused Status","type":"stat"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"short"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":6,"y":21},"id":29,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showPercentChange":false,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sabnzbd_queue_warnings{service=\"sabnzbd\", component=\"download-clients\"} * on(pod) group_left() (kube_pod_status_phase{namespace=\"$namespace\",pod=~\"$pod_regex\",phase=\"Running\"} @ end())","refId":"A"}],"title":"Queue Warnings","type":"stat"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"s"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":12,"y":21},"id":30,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showPercentChange":false,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sabnzbd_time_estimate_seconds{service=\"sabnzbd\", component=\"download-clients\"} * on(pod) group_left() (kube_pod_status_phase{namespace=\"$namespace\",pod=~\"$pod_regex\",phase=\"Running\"} @ end())","refId":"A"}],"title":"Time Estimate","type":"stat"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":18,"y":21},"id":31,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showPercentChange":false,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sabnzbd_article_cache_bytes{service=\"sabnzbd\", component=\"download-clients\"} * on(pod) group_left() (kube_pod_status_phase{namespace=\"$namespace\",pod=~\"$pod_regex\",phase=\"Running\"} @ end())","refId":"A"}],"title":"Article Cache Bytes","type":"stat"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":8,"w":24,"x":0,"y":25},"id":32,"options":{"legend":{"calcs":["last","max","mean"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"10.0.0","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"increase(sabnzbd_server_downloaded_bytes{service=\"sabnzbd\", component=\"download-clients\"}[5m])","legendFormat":"{{server}}","refId":"A"}],"title":"Server Downloaded Bytes (5m) by Server","type":"timeseries"},{"collapsed":true,"gridPos":{"h":1,"w":24,"x":0,"y":33},"id":300,"panels":[{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":37},"id":26,"options":{"legend":{"calcs":["last","max","mean"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"10.0.0","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sabnzbd_remaining_bytes{service=\"sabnzbd\", component=\"download-clients\"} * on(pod) group_left() (kube_pod_status_phase{namespace=\"$namespace\",pod=~\"$pod_regex\",phase=\"Running\"} @ end())","legendFormat":"Remaining Bytes","refId":"A"},{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sabnzbd_total_bytes{service=\"sabnzbd\", component=\"download-clients\"} * on(pod) group_left() (kube_pod_status_phase{namespace=\"$namespace\",pod=~\"$pod_regex\",phase=\"Running\"} @ end())","legendFormat":"Total Bytes","refId":"B"}],"title":"Remaining vs Total Bytes","type":"timeseries"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":12,"y":37},"id":27,"options":{"legend":{"calcs":["last","max","mean"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"10.0.0","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"increase(sabnzbd_downloaded_bytes{service=\"sabnzbd\", component=\"download-clients\"}[5m])","legendFormat":"Downloaded (5m)","refId":"A"},{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sabnzbd_downloaded_bytes{service=\"sabnzbd\", component=\"download-clients\"} * on(pod) group_left() (kube_pod_status_phase{namespace=\"$namespace\",pod=~\"$pod_regex\",phase=\"Running\"} @ end())","legendFormat":"Total Downloaded","refId":"B"}],"title":"Downloaded Bytes","type":"timeseries"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":0,"y":45},"id":201,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showPercentChange":false,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sabnzbd_remaining_quota_bytes{service=\"sabnzbd\", component=\"download-clients\"} * on(pod) group_left() (kube_pod_status_phase{namespace=\"$namespace\",pod=~\"$pod_regex\",phase=\"Running\"} @ end())","refId":"A"}],"title":"Remaining Quota","type":"stat"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":6,"y":45},"id":202,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showPercentChange":false,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"editorMode":"code","expr":"sabnzbd_quota_bytes{service=\"sabnzbd\", component=\"download-clients\"}\n* on(pod)\ngroup_left()\n(\n  kube_pod_status_phase{\n    namespace=\"$namespace\",\n    pod=~\"$pod_regex\",\n    phase=\"Running\"\n  } @ end()\n)","range":true,"refId":"A"}],"title":"Quota","type":"stat"}],"title":"Progress \u0026 Capacity","type":"row"},{"collapsed":false,"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"max":100,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"green"},{"color":"yellow","value":70},{"color":"red","value":85}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":1,"w":24,"x":0,"y":34},"id":101,"panels":[],"title":"ðŸ’» Resource Usage","type":"row"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"max":100,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":70},{"color":"red","value":85}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":8,"w":8,"x":0,"y":35},"id":9,"options":{"displayMode":"gradient","minVizHeight":10,"minVizWidth":0,"orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showThresholdLabels":false,"showThresholdMarkers":true,"sizing":"auto","text":{}},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sum(rate(container_cpu_usage_seconds_total{namespace=\"$namespace\", container=\"sabnzbd\"}[5m])) / sum(kube_pod_container_resource_limits{resource=\"cpu\", namespace=\"$namespace\", container=\"sabnzbd\"}) * 100","refId":"A"}],"title":"CPU Usage","type":"gauge"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"max":100,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":70},{"color":"red","value":85}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":8,"w":8,"x":8,"y":35},"id":10,"options":{"displayMode":"gradient","minVizHeight":10,"minVizWidth":0,"orientation":"auto","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showThresholdLabels":false,"showThresholdMarkers":true,"sizing":"auto","text":{}},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sum(container_memory_working_set_bytes{namespace=\"$namespace\", container=\"sabnzbd\"}) / sum(kube_pod_container_resource_limits{resource=\"memory\", namespace=\"$namespace\", container=\"sabnzbd\"}) * 100","refId":"A"}],"title":"Memory Usage","type":"gauge"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":0.1},{"color":"red","value":0.5}]},"unit":"s"},"overrides":[]},"gridPos":{"h":8,"w":8,"x":16,"y":35},"id":33,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showPercentChange":false,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sum(rate(container_cpu_cfs_throttled_seconds_total{namespace=\"$namespace\", container=\"sabnzbd\"}[5m]))","refId":"A"}],"title":"CPU Throttling Rate","type":"stat"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":43},"id":12,"options":{"legend":{"calcs":["last","max","mean"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"10.0.0","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sum(rate(container_cpu_usage_seconds_total{namespace=\"$namespace\", container=\"sabnzbd\"}[5m])) / sum(kube_pod_container_resource_limits{resource=\"cpu\", namespace=\"$namespace\", container=\"sabnzbd\"}) * 100","legendFormat":"CPU Usage %","refId":"A"},{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"max((kube_pod_container_resource_requests{resource=\"cpu\", namespace=\"$namespace\", container=\"sabnzbd\"} / kube_pod_container_resource_limits{resource=\"cpu\", namespace=\"$namespace\", container=\"sabnzbd\"}) * 100) by (namespace, container)","legendFormat":"CPU Request","refId":"B"},{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"100","legendFormat":"CPU Limit","refId":"C"}],"title":"CPU Usage Over Time","type":"timeseries"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":12,"y":43},"id":13,"options":{"legend":{"calcs":["last","max","mean"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"10.0.0","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sum(container_memory_working_set_bytes{namespace=\"$namespace\", container=\"sabnzbd\"})","legendFormat":"Memory Used","refId":"A"},{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sum(kube_pod_container_resource_limits{resource=\"memory\", namespace=\"$namespace\", container=\"sabnzbd\"})","legendFormat":"Memory Limit","refId":"B"},{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sum(kube_pod_container_resource_requests{resource=\"memory\", namespace=\"$namespace\", container=\"sabnzbd\"})","legendFormat":"Memory Request","refId":"C"}],"title":"Memory Usage Over Time","type":"timeseries"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"max":100,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":70},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":0,"y":51},"id":430,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showPercentChange":false,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"(kubelet_volume_stats_available_bytes{namespace=\"$namespace\", persistentvolumeclaim=~\".*sabnzbd.*\"} / kubelet_volume_stats_capacity_bytes{namespace=\"$namespace\", persistentvolumeclaim=~\".*sabnzbd.*\"}) * 100","refId":"A"}],"title":"PVC Available %","type":"stat"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"max":100,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":70},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":6,"y":51},"id":431,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showPercentChange":false,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"(kubelet_volume_stats_inodes_used{namespace=\"$namespace\", persistentvolumeclaim=~\".*sabnzbd.*\"} / kubelet_volume_stats_inodes{namespace=\"$namespace\", persistentvolumeclaim=~\".*sabnzbd.*\"}) * 100","refId":"A"}],"title":"PVC Inode Usage %","type":"stat"},{"datasource":{"name":"Prometheus","type":"prometheus"},"description":"Alerts: SabnzbdPVCHighUsage","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"max":100,"min":0,"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":70},{"color":"red","value":80}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":12,"y":51},"id":15,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showPercentChange":false,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"(kubelet_volume_stats_used_bytes{persistentvolumeclaim=\"sabnzbd-config\", namespace=\"$namespace\"} / kubelet_volume_stats_capacity_bytes{persistentvolumeclaim=\"sabnzbd-config\", namespace=\"$namespace\"}) * 100","refId":"A"}],"title":"Config PVC Usage","type":"stat"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"bytes"},"overrides":[]},"gridPos":{"h":4,"w":6,"x":18,"y":51},"id":16,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showPercentChange":false,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"(sabnzbd_disk_total_bytes{service=\"sabnzbd\", component=\"download-clients\", folder=\"download\"} * on(pod) group_left() (kube_pod_status_phase{namespace=\"$namespace\",pod=~\"$pod_regex\",phase=\"Running\"} @ end()) - sabnzbd_disk_used_bytes{service=\"sabnzbd\", component=\"download-clients\", folder=\"download\"} * on(pod) group_left() (kube_pod_status_phase{namespace=\"$namespace\",pod=~\"$pod_regex\",phase=\"Running\"} @ end()))","refId":"A"}],"title":"Available Disk Space (Download)","type":"stat"},{"datasource":{"type":"prometheus","uid":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"Bps"},"overrides":[]},"gridPos":{"h":6,"w":24,"x":0,"y":55},"id":421,"options":{"legend":{"calcs":["last","max","mean"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"10.0.0","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sum(rate(container_fs_reads_bytes_total{pod=~\"$pod_regex\", namespace=\"$namespace\"}[5m]))","legendFormat":"Read IO","refId":"A"},{"datasource":{"type":"prometheus","uid":"prometheus"},"editorMode":"code","expr":"sum(rate(container_fs_writes_bytes_total{pod=~\"$pod_regex\", namespace=\"$namespace\"}[5m]))","hide":false,"instant":false,"legendFormat":"Write IO","range":true,"refId":"B"}],"title":"Filesystem Read / Write IO","type":"timeseries"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"ms"},"overrides":[]},"gridPos":{"h":4,"w":24,"x":0,"y":61},"id":403,"options":{"legend":{"calcs":["last","max","mean"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"10.0.0","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"histogram_quantile(0.95, sum(rate(istio_request_duration_milliseconds_bucket{destination_service_name=\"sabnzbd\", destination_service_namespace=\"$namespace\"}[5m])) by (le))","legendFormat":"p95 Response Time","refId":"A"}],"title":"Response Time (p95)","type":"timeseries"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"reqps"},"overrides":[]},"gridPos":{"h":5,"w":6,"x":0,"y":65},"id":401,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showPercentChange":false,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sum(rate(istio_requests_total{destination_service_name=\"sabnzbd\", destination_service_namespace=\"$namespace\"}[5m]))","refId":"A"}],"title":"Request Rate","type":"stat"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"reqps"},"overrides":[]},"gridPos":{"h":5,"w":18,"x":6,"y":65},"id":402,"options":{"legend":{"calcs":["last","max","mean"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"10.0.0","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sum(rate(istio_requests_total{destination_service_name=\"sabnzbd\", destination_service_namespace=\"$namespace\"}[5m]))","legendFormat":"Request Rate (req/s)","refId":"A"}],"title":"Request Rate Over Time","type":"timeseries"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":0.1},{"color":"red","value":1}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":5,"w":6,"x":0,"y":70},"id":404,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showPercentChange":false,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"(sum(rate(istio_requests_total{destination_service_name=\"sabnzbd\", destination_service_namespace=\"$namespace\", response_code=~\"5..\"}[5m])) / sum(rate(istio_requests_total{destination_service_name=\"sabnzbd\", destination_service_namespace=\"$namespace\"}[5m]))) * 100","refId":"A"}],"title":"Error Rate","type":"stat"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"percent"},"overrides":[]},"gridPos":{"h":5,"w":18,"x":6,"y":70},"id":405,"options":{"legend":{"calcs":["last","max","mean"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"10.0.0","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"(sum(rate(istio_requests_total{destination_service_name=\"sabnzbd\", destination_service_namespace=\"$namespace\", response_code=~\"5..\"}[5m])) / sum(rate(istio_requests_total{destination_service_name=\"sabnzbd\", destination_service_namespace=\"$namespace\"}[5m]))) * 100","legendFormat":"Error Rate (%)","refId":"A"}],"title":"Error Rate Over Time","type":"timeseries"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"Bps"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":0,"y":75},"id":411,"options":{"legend":{"calcs":["last","max","mean"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"10.0.0","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sum(rate(container_network_receive_bytes_total{pod=~\"$pod_regex\", namespace=\"$namespace\"}[5m]))","legendFormat":"rx","refId":"A"},{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sum(rate(container_network_transmit_bytes_total{pod=~\"$pod_regex\", namespace=\"$namespace\"}[5m]))","legendFormat":"tx","refId":"B"}],"title":"Network Throughput","type":"timeseries"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"axisBorderShow":false,"axisCenteredZero":false,"axisColorMode":"text","axisLabel":"","axisPlacement":"auto","barAlignment":0,"drawStyle":"line","fillOpacity":10,"gradientMode":"none","hideFrom":{"legend":false,"tooltip":false,"viz":false},"insertNulls":false,"lineInterpolation":"linear","lineWidth":1,"pointSize":5,"scaleDistribution":{"type":"linear"},"showPoints":"never","spanNulls":false,"stacking":{"group":"A","mode":"none"},"thresholdsStyle":{"mode":"off"}},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"short"},"overrides":[]},"gridPos":{"h":8,"w":12,"x":12,"y":75},"id":412,"options":{"legend":{"calcs":["last","max","mean"],"displayMode":"table","placement":"bottom","showLegend":true},"tooltip":{"mode":"multi","sort":"none"}},"pluginVersion":"10.0.0","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sum(rate(container_network_receive_errors_total{pod=~\"$pod_regex\", namespace=\"$namespace\"}[5m]))","legendFormat":"rx_err","refId":"A"},{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sum(rate(container_network_transmit_errors_total{pod=~\"$pod_regex\", namespace=\"$namespace\"}[5m]))","legendFormat":"tx_err","refId":"B"},{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sum(rate(container_network_receive_packets_dropped_total{pod=~\"$pod_regex\", namespace=\"$namespace\"}[5m]))","legendFormat":"rx_drop","refId":"C"},{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sum(rate(container_network_transmit_packets_dropped_total{pod=~\"$pod_regex\", namespace=\"$namespace\"}[5m]))","legendFormat":"tx_drop","refId":"D"}],"title":"Network Errors / Drops","type":"timeseries"},{"collapsed":true,"gridPos":{"h":1,"w":24,"x":0,"y":83},"id":440,"panels":[],"title":"ðŸ§  Kubernetes Diagnostics","type":"row"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"auto","cellOptions":{"type":"auto"},"inspect":false},"mappings":[{"id":"health-type","options":{"error":{"color":"red","text":"Error"},"warning":{"color":"yellow","text":"Warning"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":1},{"color":"red","value":2}]},"unit":"short"},"overrides":[{"matcher":{"id":"byName","options":"Type"},"properties":[{"id":"mappings","value":{"options":{"error":{"color":"red","text":"Error"},"warning":{"color":"yellow","text":"Warning"}},"type":"value"}}]}]},"gridPos":{"h":5,"w":20,"x":0,"y":84},"id":441,"options":{"cellHeight":"sm","footer":{"countRows":false,"fields":"","reducer":["sum"],"show":false},"showHeader":true,"sortBy":[{"desc":true,"displayName":"Value"}]},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"kube_pod_container_status_waiting_reason{pod=~\"$pod_regex\", namespace=\"$namespace\"}","format":"table","instant":true,"refId":"A"}],"title":"Container Waiting Reasons","transformations":[{"id":"organize","options":{"excludeByName":{"__name__":true,"component":true,"service":true,"url":true,"wikiurl":true},"indexByName":{"Message":2,"Source":1,"Type":0,"Value":3},"renameByName":{"Value":"Value","message":"Message","source":"Source","type":"Type"}}}],"type":"table"},{"datasource":{"name":"Prometheus","type":"prometheus"},"description":"Alerts: SabnzbdPodRestarting","fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"short"},"overrides":[]},"gridPos":{"h":5,"w":4,"x":20,"y":84},"id":14,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showPercentChange":false,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"sum(increase(kube_pod_container_status_restarts_total{pod=~\"$pod_regex\", namespace=\"$namespace\"}[1h]) * on(pod, namespace) group_left() kube_pod_info{pod=~\"$pod_regex\", namespace=\"$namespace\"}) by (namespace)","refId":"A"}],"title":"Pod Restarts (1h)","type":"stat"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"auto","cellOptions":{"type":"auto"},"inspect":false},"mappings":[{"id":"health-type","options":{"error":{"color":"red","text":"Error"},"warning":{"color":"yellow","text":"Warning"}},"type":"value"}],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"yellow","value":1},{"color":"red","value":2}]},"unit":"short"},"overrides":[{"matcher":{"id":"byName","options":"Type"},"properties":[{"id":"mappings","value":{"options":{"error":{"color":"red","text":"Error"},"warning":{"color":"yellow","text":"Warning"}},"type":"value"}}]}]},"gridPos":{"h":5,"w":20,"x":0,"y":89},"id":442,"options":{"cellHeight":"sm","footer":{"countRows":false,"fields":"","reducer":["sum"],"show":false},"showHeader":true,"sortBy":[{"desc":true,"displayName":"Value"}]},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"kube_pod_container_status_terminated_reason{pod=~\"$pod_regex\", namespace=\"$namespace\"}","format":"table","instant":true,"refId":"A"}],"title":"Container Terminated Reasons","transformations":[{"id":"organize","options":{"excludeByName":{"__name__":true,"component":true,"service":true,"url":true,"wikiurl":true},"indexByName":{"Message":2,"Source":1,"Type":0,"Value":3},"renameByName":{"Value":"Value","message":"Message","source":"Source","type":"Type"}}}],"type":"table"},{"datasource":{"name":"Prometheus","type":"prometheus"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null}]},"unit":"short"},"overrides":[]},"gridPos":{"h":5,"w":4,"x":20,"y":89},"id":443,"options":{"colorMode":"value","graphMode":"area","justifyMode":"auto","orientation":"auto","percentChangeColorMode":"standard","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":false},"showPercentChange":false,"textMode":"auto","wideLayout":true},"pluginVersion":"11.1.3","targets":[{"datasource":{"name":"Prometheus","type":"prometheus"},"expr":"kube_pod_container_status_last_terminated_exitcode{pod=~\"$pod_regex\", namespace=\"$namespace\"}","refId":"A"}],"title":"Last Terminated Exit Code","type":"stat"}],"refresh":"30s","schemaVersion":39,"tags":["sabnzbd","download-clients","monitoring","exportarr","sabnzbd","download-clients","monitoring","exportarr"],"templating":{"list":[{"hide":2,"name":"namespace","query":"download-clients","skipUrlSync":false,"type":"constant"},{"hide":2,"name":"deployment","query":"sabnzbd","skipUrlSync":false,"type":"constant"},{"hide":2,"name":"pod_regex","query":"sabnzbd-.*","skipUrlSync":false,"type":"constant"}]},"time":{"from":"now-6h","to":"now"},"timepicker":{},"timezone":"","title":"SABnzbd Dashboard","uid":"sabnzbd-download-clients","version":1,"weekStart":""}
  allowCrossNamespaceImport: true
---
# Source: sabnzbd/templates/all.yaml
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: sabnzbd-route
  namespace: download-clients
  labels:
    app.kubernetes.io/instance: sabnzbd
    app.kubernetes.io/name: sabnzbd
    app.kubernetes.io/version: 4.5.3
    helm.sh/chart: sabnzbd-0.0.4
    app.kubernetes.io/component: "http-route"
  annotations:
    argocd.argoproj.io/sync-wave: "1"
spec:
  parentRefs:
    - name: shared-platform-gateway
      namespace: istio-system
      kind: Gateway
      group: gateway.networking.k8s.io
      sectionName: https
  hostnames:
    - sabnzbd-k8s.orhayoun.com
  rules:
    -
      matches:
        - path:
            type: PathPrefix
            value: /
      backendRefs:
        - group: ""
          kind: Service
          name: sabnzbd-http
          port: 8080
          weight: 100
---
# Source: sabnzbd/templates/all.yaml
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: sabnzbd-http-redirect
  namespace: download-clients
  labels:
    app.kubernetes.io/instance: sabnzbd
    app.kubernetes.io/name: sabnzbd
    app.kubernetes.io/version: 4.5.3
    helm.sh/chart: sabnzbd-0.0.4
    app.kubernetes.io/component: "http-route"
  annotations:
    argocd.argoproj.io/sync-wave: "1"
spec:
  parentRefs:
    - name: shared-platform-gateway
      namespace: istio-system
      kind: Gateway
      group: gateway.networking.k8s.io
      sectionName: http
  hostnames:
    - sabnzbd-k8s.orhayoun.com
  rules:
    -
      matches:
        - path:
            type: PathPrefix
            value: /
      filters:
        - requestRedirect:
            scheme: https
            statusCode: 301
          type: RequestRedirect
---
# Source: sabnzbd/templates/all.yaml
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: sabnzbd
  namespace: download-clients
  labels:
    app.kubernetes.io/instance: sabnzbd
    app.kubernetes.io/name: sabnzbd
    app.kubernetes.io/version: 4.5.3
    helm.sh/chart: sabnzbd-0.0.4
    app.kubernetes.io/component: "prometheus-rule"

spec:
  groups:
    - name: sabnzbd.rules
      rules:
        - alert: SabnzbdDown
          annotations:
            description: Prometheus cannot scrape sabnzbd metrics (job sabnzbd/sabnzbd-metrics)
              for more than 5 minutes.
            summary: Sabnzbd metrics target is down
          expr: up{job=~"sabnzbd|sabnzbd-metrics"} == 0
          for: 5m
          labels:
            component: download-clients
            service: sabnzbd
            severity: critical
        - alert: SabnzbdQueueHigh
          annotations:
            description: Sabnzbd has more than 100 items in the download queue for more than
              10 minutes.
            summary: Sabnzbd queue is high
          expr: sabnzbd_queue_length{service="sabnzbd", component="download-clients"} > 100
          for: 10m
          labels:
            component: download-clients
            service: sabnzbd
            severity: warning
        - alert: SabnzbdQueueWarnings
          annotations:
            description: Sabnzbd reports queue warnings for more than 15 minutes. Inspect
              SABnzbd UI/logs for details.
            summary: Sabnzbd queue warnings detected
          expr: sabnzbd_queue_warnings{service="sabnzbd", component="download-clients"} >
            0
          for: 15m
          labels:
            component: download-clients
            service: sabnzbd
            severity: warning
        - alert: SabnzbdDownloadDiskFreeLow
          annotations:
            description: Sabnzbd reports less than 20GiB free in folder=download for more
              than 5 minutes.
            summary: Sabnzbd download disk free space is low
          expr: (sabnzbd_disk_total_bytes{service="sabnzbd", component="download-clients",
            folder="download"} - sabnzbd_disk_used_bytes{service="sabnzbd", component="download-clients",
            folder="download"}) < 20 * 1024 * 1024 * 1024
          for: 5m
          labels:
            component: download-clients
            service: sabnzbd
            severity: warning
            volume_type: download
        - alert: SabnzbdCompleteDiskFreeLow
          annotations:
            description: Sabnzbd reports less than 20GiB free in folder=complete for more
              than 5 minutes.
            summary: Sabnzbd complete disk free space is low
          expr: (sabnzbd_disk_total_bytes{service="sabnzbd", component="download-clients",
            folder="complete"} - sabnzbd_disk_used_bytes{service="sabnzbd", component="download-clients",
            folder="complete"}) < 20 * 1024 * 1024 * 1024
          for: 5m
          labels:
            component: download-clients
            service: sabnzbd
            severity: warning
            volume_type: complete
        - alert: SabnzbdExportarrRestarting
          annotations:
            description: Exportarr sidecar container in Sabnzbd pod {{ $labels.pod }} has
              restarted more than 2 times in the last hour.
            summary: Sabnzbd Exportarr sidecar restarting frequently
          expr: increase(kube_pod_container_status_restarts_total{namespace="download-clients",
            pod=~"sabnzbd-.*", container=~"exportarr|exporter"}[1h]) > 2
          for: 0m
          labels:
            component: download-clients
            service: sabnzbd
            severity: warning
            sidecar: exportarr
        - alert: SabnzbdExporterNotReady
          annotations:
            description: Exportarr container in Sabnzbd pod {{ $labels.pod }} is not ready
              for more than 2 minutes. Check exporter container logs.
            summary: Sabnzbd Exportarr sidecar is not ready
          expr: |
            kube_deployment_status_replicas_available{deployment="sabnzbd", namespace="download-clients"} > 0
            and
            kube_pod_container_status_ready{container=~"exportarr|exporter", pod=~"sabnzbd-.*", namespace="download-clients"} == 0
          for: 2m
          labels:
            component: download-clients
            service: sabnzbd
            severity: warning
            sidecar: exportarr
        - alert: SabnzbdExportarrMetricsUnavailable
          annotations:
            description: Sabnzbd pod is running but Exportarr metrics are missing for more
              than 5 minutes. Check Exportarr container logs in pod {{ $labels.pod }}.
            summary: Sabnzbd Exportarr metrics endpoint unavailable
          expr: kube_deployment_status_replicas_available{deployment="sabnzbd", namespace="download-clients"}
            > 0 and absent_over_time(sabnzbd_info{service="sabnzbd", component="download-clients"}[5m])
          for: 5m
          labels:
            component: download-clients
            service: sabnzbd
            severity: warning
            sidecar: exportarr
        - alert: SabnzbdAuthorizationPolicyDenials
          annotations:
            description: Sabnzbd is experiencing authorization policy denials. {{ $value }}
              requests/sec are being denied.
            summary: Sabnzbd authorization policy denials detected
          expr: sum(rate(istio_requests_total{destination_workload="sabnzbd", destination_workload_namespace="download-clients",
            destination_service_name="sabnzbd", request_protocol="http", response_code="403",
            response_flags="SEC"}[5m])) > 0
          for: 2m
          labels:
            component: download-clients
            security: authorization
            service: sabnzbd
            severity: warning
        - alert: SabnzbdHighAuthorizationDenialRate
          annotations:
            description: Sabnzbd has a high authorization denial rate ({{ $value }}% of requests
              denied). This may indicate a misconfigured authorization policy.
            summary: Sabnzbd high authorization denial rate
          expr: |
            (
              sum(rate(istio_requests_total{destination_workload="sabnzbd", destination_workload_namespace="download-clients", destination_service_name="sabnzbd", request_protocol="http", response_code="403", response_flags="SEC"}[5m]))
              /
              sum(rate(istio_requests_total{destination_workload="sabnzbd", destination_workload_namespace="download-clients", destination_service_name="sabnzbd", request_protocol="http"}[5m]))
            ) * 100 > 5
          for: 5m
          labels:
            component: download-clients
            security: authorization
            service: sabnzbd
            severity: critical
        - alert: SabnzbdStalledDownloads
          annotations:
            description: Sabnzbd has items in queue but average download speed is < 1KiB/s
              for 10 minutes.
            summary: Sabnzbd downloads appear stalled
          expr: sabnzbd_queue_length{service="sabnzbd", component="download-clients"} > 0
            and avg_over_time(sabnzbd_speed_bps{service="sabnzbd", component="download-clients"}[10m])
            < 1024
          for: 10m
          labels:
            component: download-clients
            service: sabnzbd
            severity: warning
        - alert: SabnzbdProviderSuccessRateLow
          annotations:
            description: Overall SABnzbd server article success rate < 95% for 15 minutes
              (provider/indexer issues likely).
            summary: Sabnzbd provider success rate is low
          expr: (sum(increase(sabnzbd_server_articles_success{service="sabnzbd", component="download-clients"}[15m]))
            / sum(increase(sabnzbd_server_articles_total{service="sabnzbd", component="download-clients"}[15m])))
            < 0.95
          for: 15m
          labels:
            component: download-clients
            service: sabnzbd
            severity: warning
        - alert: SabnzbdExportarrScrapeSlow
          annotations:
            description: Exportarr scrape duration > 2s (max over 10m). Check SAB API responsiveness
              and exporter logs.
            summary: Sabnzbd exporter scrape is slow
          expr: max_over_time(sabnzbd_scrape_duration_seconds{service="sabnzbd", component="download-clients"}[10m])
            > 2
          for: 10m
          labels:
            component: download-clients
            service: sabnzbd
            severity: warning
            sidecar: exportarr
        - alert: SabnzbdHighCPUUtilization
          annotations:
            description: Sabnzbd CPU usage is above 80% of requested CPU for more than 10
              minutes (value={{ $value }}%).
            summary: Sabnzbd CPU utilization is high
          expr: |
            (
              sum(rate(container_cpu_usage_seconds_total{namespace="download-clients", pod=~"sabnzbd-.*", container="sabnzbd"}[5m]))
              /
              sum(kube_pod_container_resource_requests{namespace="download-clients", pod=~"sabnzbd-.*", container="sabnzbd", resource="cpu"})
            ) * 100 > 80
          for: 10m
          labels:
            component: download-clients
            resource: cpu
            service: sabnzbd
            severity: warning
        - alert: SabnzbdHighMemoryUtilization
          annotations:
            description: Sabnzbd memory working set is above 85% of memory limit for more
              than 10 minutes (value={{ $value }}%).
            summary: Sabnzbd memory utilization is high
          expr: |
            (
              max(container_memory_working_set_bytes{namespace="download-clients", pod=~"sabnzbd-.*", container="sabnzbd"})
              /
              max(kube_pod_container_resource_limits{namespace="download-clients", pod=~"sabnzbd-.*", container="sabnzbd", resource="memory"})
            ) * 100 > 85
          for: 10m
          labels:
            component: download-clients
            resource: memory
            service: sabnzbd
            severity: warning
---
# Source: sabnzbd/templates/all.yaml
apiVersion: monitoring.coreos.com/v1
kind: ServiceMonitor
metadata:
  name: sabnzbd
  namespace: download-clients
  labels:
    app.kubernetes.io/instance: sabnzbd
    app.kubernetes.io/name: sabnzbd
    app.kubernetes.io/version: 4.5.3
    helm.sh/chart: sabnzbd-0.0.4
    app.kubernetes.io/component: "servicemonitor"
  annotations:
    argocd.argoproj.io/sync-wave: "2"
spec:
  selector:
    matchLabels:
      app.kubernetes.io/component: service-metrics
      app.kubernetes.io/instance: sabnzbd
      app.kubernetes.io/name: sabnzbd
  namespaceSelector:
    matchNames:
    - download-clients
  endpoints:
    - port: metrics
      interval: 10s
      scrapeTimeout: 5s
      path: /metrics
      honorLabels: true
      relabelings:
        - action: replace
          sourceLabels:
          - __meta_kubernetes_namespace
          targetLabel: namespace
        - action: replace
          sourceLabels:
          - __meta_kubernetes_pod_name
          targetLabel: instance
      metricRelabelings:
        - action: replace
          replacement: sabnzbd
          targetLabel: service
        - action: replace
          replacement: download-clients
          targetLabel: component
