suite: sabnzbd chart contract
templates:
  - templates/all.yaml
tests:
  - it: renders expected default resource set and ingress host
    asserts:
      - hasDocuments:
          count: 15
      - documentIndex: 4
        equal:
          path: spec.hostnames[0]
          value: sabnzbd-k8s.orhayoun.com
      - documentIndex: 13
        equal:
          path: spec.instanceSelector.matchLabels["app.kubernetes.io/instance"]
          value: prometheus
      - documentIndex: 13
        equal:
          path: spec.instanceSelector.matchLabels["app.kubernetes.io/name"]
          value: grafana
      - documentIndex: 11
        equal:
          path: kind
          value: ServiceMonitor

  - it: wires sabnzbd application container security and pvc correctly
    asserts:
      - documentIndex: 1
        equal:
          path: spec.template.spec.containers[1].name
          value: sabnzbd
      - documentIndex: 1
        equal:
          path: spec.template.spec.containers[1].securityContext.readOnlyRootFilesystem
          value: true
      - documentIndex: 1
        equal:
          path: spec.template.spec.containers[1].securityContext.runAsUser
          value: 1010
      - documentIndex: 1
        equal:
          path: spec.template.spec.containers[1].securityContext.runAsGroup
          value: 1010
      - documentIndex: 14
        equal:
          path: metadata.name
          value: sabnzbd-config

  - it: keeps minimal scenario render compact and deterministic
    values:
      - scenarios/minimal.yaml
    asserts:
      - hasDocuments:
          count: 5
