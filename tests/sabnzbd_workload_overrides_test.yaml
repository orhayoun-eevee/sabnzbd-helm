suite: sabnzbd workload overrides
templates:
  - templates/all.yaml
tests:
  - it: applies deployment replica override
    set:
      deployment:
        replicas: 2
    asserts:
      - documentSelector:
          path: kind
          value: Deployment
        equal:
          path: spec.replicas
          value: 2

  - it: applies pod security context fsGroup override
    set:
      deployment:
        podSecurityContext:
          fsGroup: 2000
    asserts:
      - documentSelector:
          path: kind
          value: Deployment
        equal:
          path: spec.template.spec.securityContext.fsGroup
          value: 2000

  - it: applies persistence pvc size override
    set:
      persistence:
        claims:
          config:
            size: 2Gi
    asserts:
      - documentSelector:
          path: metadata.name
          value: sabnzbd-config
        equal:
          path: spec.resources.requests.storage
          value: 2Gi

  - it: applies container cpu limit override
    set:
      deployment:
        containers:
          sabnzbd:
            resources:
              limits:
                cpu: 750m
    asserts:
      - documentIndex: 1
        equal:
          path: spec.template.spec.containers[1].resources.limits.cpu
          value: 750m

  - it: applies container security context runAsUser override
    set:
      deployment:
        containers:
          sabnzbd:
            securityContext:
              runAsUser: 2001
    asserts:
      - documentIndex: 1
        equal:
          path: spec.template.spec.containers[1].securityContext.runAsUser
          value: 2001
